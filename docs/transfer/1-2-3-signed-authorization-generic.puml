@startuml

title Transfer: 1.2.3 Signed Authorization


box "PISP"
participant "PISP Server" as D1
end box
box "Mojaloop"
    participant Switch as S
end box
box "DFSP A"
    participant "DFSP A\n(Payer)" as D2
end box
== Agreement Phase ==
note right of D1
  PISP looks up the ""transactionRequestId"" and
  checks the quote with the user.

  If the user agrees to the terms, the PISP uses
  the Credential's privateKey to sign the challenge
end note

rnote right of D1 #Light
**""PUT /thirdpartyRequests/authorizations/33333333-0000-0000-0000-000000000000""**
""FSPIOP-Source: pispa""
""FSPIOP-Destination: dfspa""
{
  "responseType": "ACCEPTED"
  "signedPayload": {
    "signedPayloadType": "GENERIC",
    "value": "utf-8 base64 encoded signature"
  }
}
end note
D1 -> S: ""PUT /thirdpartyRequests/authorizations/33333333-0000-0000-0000-000000000000""
S --> D1: ""200 OK""
S -> D2: ""PUT /thirdpartyRequests/authorizations""\n""/33333333-0000-0000-0000-000000000000""
D2 --> S: ""200 OK""

D2 -> D2: Look up the ""transactionRequestId"" for this ""authorizationId""
D2 -> D2: Look up the ""consentId"" for this ""transactionRequestId""

note over D2
  DFSP has the signed challenge.
  It now needs to ask the Auth-Service to verify
  the signed challenge.
end note

@enduml
